<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UsoJaleco | Comprar Slides</title>
  <meta name="description" content="Vitrine de slides e templates de medicina organizados por especialidade.">
  <meta name="theme-color" content="#0a0b0f">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/arthurambrosi/usojaleco/0204905b333f11d1eec3c7c6667d17dbfb457774/Design%20sem%20nome%20(28).png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0b0f;
      --card-bg: #12141b;
      --card-bg-2: #171a24;
      --text: #e6e9ef;
      --muted: #9aa4b2;
      --accent: #ff7a18;
      --accent-2: #ffb703;
      --line: #232838;
      --ok: #67d8a8;
      --error: #ff8c8c;
      --tap: 44px;
      --radius: 18px;
      --radius-sm: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Manrope", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    html,
    body {
      min-height: 100%;
    }

    body {
      background:
        radial-gradient(1100px 600px at 90% -10%, rgba(255, 122, 24, 0.12), transparent 62%),
        radial-gradient(900px 500px at -10% 10%, rgba(255, 183, 3, 0.08), transparent 58%),
        var(--bg);
      color: var(--text);
      padding: 18px;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .wrap {
      width: min(1200px, 100%);
      margin: 0 auto;
    }

    .navBar {
      background: linear-gradient(180deg, rgba(18, 20, 27, 0.92), rgba(10, 11, 15, 0.88));
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      padding: 12px 14px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.28);
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 22px;
    }

    .navLeft {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logoBox {
      width: 42px;
      height: 42px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
      flex: 0 0 auto;
    }

    .logoBox img {
      width: 30px;
      height: 30px;
      object-fit: contain;
      background: #fff;
      border-radius: 8px;
      padding: 3px;
    }

    .brandName {
      font-size: 18px;
      font-weight: 900;
      letter-spacing: 0.2px;
      color: #fff;
      line-height: 1.02;
    }

    .brandSub {
      margin-top: 4px;
      color: rgba(230, 233, 239, 0.78);
      font-size: 11px;
      font-weight: 500;
      display: block;
    }

    .social {
      display: flex;
      gap: 8px;
    }

    .social a {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.03);
      transition: border-color 0.15s ease, background 0.15s ease;
    }

    .social a:hover {
      border-color: var(--accent);
      background: rgba(255, 122, 24, 0.1);
    }

    .social svg {
      display: block;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .hero {
      border: 1px solid rgba(255, 255, 255, 0.09);
      background: linear-gradient(150deg, rgba(24, 27, 38, 0.96), rgba(16, 18, 27, 0.95));
      border-radius: var(--radius);
      padding: 18px;
      margin-bottom: 18px;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.28);
    }

    .hero h1 {
      font-size: clamp(1.7rem, 4.6vw, 2.45rem);
      font-weight: 800;
      line-height: 1.08;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
    }

    .hero p {
      color: var(--muted);
      font-size: 0.98rem;
    }

    .showcaseHeader {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 14px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .headerText {
      flex: 1;
      min-width: 280px;
    }

    .headerText h2 {
      font-size: 1.2rem;
      font-weight: 800;
      margin-bottom: 4px;
      color: #fff;
    }

    .headerText p {
      color: var(--muted);
      font-size: 0.93rem;
    }

    .searchBox {
      width: min(370px, 100%);
      position: relative;
    }

    .searchInput {
      width: 100%;
      min-height: var(--tap);
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.03);
      color: #fff;
      padding: 11px 14px 11px 44px;
      outline: none;
      font-size: 0.94rem;
      transition: border-color 0.2s ease;
    }

    .searchInput:focus {
      border-color: var(--accent);
    }

    .searchIcon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      color: var(--muted);
      pointer-events: none;
    }

    .status {
      margin-bottom: 10px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .status.ok {
      color: var(--ok);
    }

    .status.error {
      color: var(--error);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .chip {
      min-height: 36px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.03);
      color: #edf1f9;
      padding: 0 12px;
      font-size: 0.83rem;
      font-weight: 700;
      cursor: pointer;
      transition: border-color 0.15s ease, background 0.15s ease, transform 0.15s ease;
    }

    .chip:hover {
      transform: translateY(-1px);
    }

    .chip.active {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(255, 122, 24, 0.9), rgba(255, 183, 3, 0.85));
      color: #16110d;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
      background: linear-gradient(180deg, var(--card-bg), var(--card-bg-2));
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      overflow: hidden;
      transition: transform 0.2s ease, border-color 0.2s ease;
      display: flex;
      flex-direction: column;
      min-height: 100%;
    }

    .card:hover {
      transform: translateY(-4px);
      border-color: rgba(255, 122, 24, 0.82);
    }

    .thumbWrap {
      width: 100%;
      height: 180px;
      background: #0e1118;
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .thumbWrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.45s ease;
    }

    .card:hover .thumbWrap img {
      transform: scale(1.05);
    }

    .areaTag {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1;
      border: 1px solid rgba(255, 183, 3, 0.62);
      background: rgba(22, 18, 10, 0.72);
      color: #ffd48f;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      max-width: calc(100% - 20px);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .cardBody {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
    }

    .title {
      font-size: 1.05rem;
      line-height: 1.28;
      font-weight: 800;
      color: #fff;
    }

    .desc {
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.45;
      flex: 1;
    }

    .priceRow {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.09);
      gap: 8px;
    }

    .price {
      font-size: 1.22rem;
      font-weight: 800;
      color: #fff;
      white-space: nowrap;
    }

    .price small {
      font-size: 0.78rem;
      color: var(--accent);
      margin-right: 4px;
      font-weight: 700;
    }

    .actions {
      display: flex;
      gap: 9px;
      margin-top: 2px;
    }

    .btn {
      min-height: var(--tap);
      border-radius: var(--radius-sm);
      border: 1px solid transparent;
      padding: 0 10px;
      font-size: 0.88rem;
      font-weight: 800;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      transition: transform 0.15s ease, border-color 0.15s ease, opacity 0.15s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
    }

    .btnVideo {
      background: rgba(255, 255, 255, 0.04);
      border-color: rgba(255, 255, 255, 0.11);
      color: #edf1f9;
    }

    .btnBuy {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #18120e;
      border-color: rgba(255, 255, 255, 0.08);
    }

    .empty {
      border: 1px dashed rgba(255, 255, 255, 0.18);
      border-radius: var(--radius);
      padding: 18px;
      text-align: center;
      color: var(--muted);
    }

    .foot {
      margin-top: 16px;
      color: #8d95ac;
      font-size: 0.8rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 10px;
    }

    @media (max-width: 760px) {
      body {
        padding: 12px;
      }

      .navBar {
        flex-direction: column;
        align-items: flex-start;
        gap: 14px;
      }

      .showcaseHeader {
        align-items: stretch;
      }

      .searchBox {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="navBar">
      <div class="navLeft">
        <a class="logoBox" href="../index.html" aria-label="Ir para inicio">
          <img id="brandLogo" alt="Logo UsoJaleco" src="https://raw.githubusercontent.com/arthurambrosi/usojaleco/0204905b333f11d1eec3c7c6667d17dbfb457774/Design%20sem%20nome%20(28).png">
        </a>
        <div>
          <div class="brandName">UsoJaleco</div>
          <span class="brandSub">Vitrine de Slides</span>
        </div>
      </div>

      <div class="social">
        <svg width="0" height="0" style="position:absolute;">
          <defs>
            <linearGradient id="socialGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#ff7a18"></stop>
              <stop offset="100%" stop-color="#ffb703"></stop>
            </linearGradient>
          </defs>
        </svg>

        <a href="https://www.instagram.com/usojaleco_/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="url(#socialGrad)">
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
          </svg>
        </a>
        <a href="https://www.tiktok.com/@usojaleco" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="url(#socialGrad)">
            <path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5"></path>
          </svg>
        </a>
        <a href="https://wa.me/5571981577908" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="url(#socialGrad)">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
          </svg>
        </a>
      </div>
    </header>

    <section class="hero">
      <h1>Slides premium para medicina</h1>
      <p>
        Design inspirado na vitrine de templates do repositorio `usojaleco-site`.
        Conteudos carregados da sua planilha e separados por area do tema.
      </p>
    </section>

    <section class="showcaseHeader">
      <div class="headerText">
        <h2>Catalogo de apresentacoes</h2>
        <p>Filtre por especialidade ou busque por titulo.</p>
      </div>

      <div class="searchBox">
        <svg class="searchIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input id="searchInput" class="searchInput" type="search" placeholder="Buscar slide...">
      </div>
    </section>

    <p id="status" class="status">Carregando slides...</p>
    <div id="categoryFilters" class="filters" aria-label="Filtros por categoria"></div>
    <div id="grid" class="grid" aria-live="polite"></div>
    <div class="foot">
      Origem: planilha Google ID <strong>1HRZzC3GWSi8DQC45y0HwmbMjyFpY_0mX5PQsvDZ3-tQ</strong> (gid <strong>1847176508</strong>).
    </div>
  </div>

  <script>
    (function () {
      const LOGO_URL = "https://raw.githubusercontent.com/arthurambrosi/usojaleco/0204905b333f11d1eec3c7c6667d17dbfb457774/Design%20sem%20nome%20(28).png";
      const DEFAULT_SHEET_ID = "1HRZzC3GWSi8DQC45y0HwmbMjyFpY_0mX5PQsvDZ3-tQ";
      const DEFAULT_GID = "1847176508";
      const DEFAULT_SHEET_NAME = "Slides";

      const params = new URLSearchParams(window.location.search);
      const SHEET_ID = params.get("sheetId") || DEFAULT_SHEET_ID;
      const SHEET_GID = params.get("gid") || DEFAULT_GID;
      const SHEET_NAME = params.get("sheet") || DEFAULT_SHEET_NAME;

      const statusEl = document.getElementById("status");
      const filtersEl = document.getElementById("categoryFilters");
      const gridEl = document.getElementById("grid");
      const searchInput = document.getElementById("searchInput");
      const brandLogo = document.getElementById("brandLogo");

      let allSlides = [];
      let activeCategory = "Todas";
      let searchTerm = "";

      if (brandLogo) {
        brandLogo.src = LOGO_URL;
      }

      function normalizeKey(value) {
        return String(value || "")
          .trim()
          .toLowerCase()
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "")
          .replace(/[^\w\s]/g, "")
          .replace(/\s+/g, "_");
      }

      function pick(obj, keys) {
        for (const key of keys) {
          const val = obj[key];
          if (val !== undefined && val !== null && String(val).trim() !== "") {
            return String(val).trim();
          }
        }
        return "";
      }

      function sanitizeUrl(url) {
        if (!url) return "#";
        try {
          const parsed = new URL(url, window.location.href);
          if (parsed.protocol === "http:" || parsed.protocol === "https:") {
            return parsed.href;
          }
        } catch (_) {}
        return "#";
      }

      function setStatus(text, mode) {
        statusEl.textContent = text;
        statusEl.className = "status" + (mode ? " " + mode : "");
      }

      function parseGvizEnvelope(raw) {
        const start = raw.indexOf("{");
        const end = raw.lastIndexOf("}");
        if (start < 0 || end < 0) {
          throw new Error("Resposta de planilha invalida.");
        }
        return JSON.parse(raw.slice(start, end + 1));
      }

      function rowsFromTable(table) {
        const cols = (table.cols || []).map(function (c, idx) {
          const label = c && c.label ? c.label.trim() : "";
          return label || "col_" + idx;
        });

        const rawRows = (table.rows || []).map(function (r) {
          const out = {};
          cols.forEach(function (col, idx) {
            const cell = r && r.c ? r.c[idx] : null;
            out[normalizeKey(col)] = cell && cell.v !== null ? String(cell.v).trim() : "";
          });
          return out;
        });

        const missingHeaders = cols.every(function (c) {
          return /^col_\d+$/.test(c);
        });

        if (!missingHeaders || rawRows.length === 0) {
          return rawRows;
        }

        const headerRow = rawRows[0];
        const headerKeys = Object.keys(headerRow);
        const dynamicHeaders = headerKeys.map(function (key, idx) {
          return normalizeKey(headerRow[key]) || "col_" + idx;
        });

        return rawRows.slice(1).map(function (row) {
          const out = {};
          headerKeys.forEach(function (key, idx) {
            out[dynamicHeaders[idx]] = row[key];
          });
          return out;
        });
      }

      function isActiveValue(val) {
        if (!val) return true;
        const v = String(val).trim().toLowerCase();
        return v === "x" || v === "1" || v === "true" || v === "sim" || v === "ativo";
      }

      function mapRowToSlide(row) {
        const title = pick(row, ["titulo", "slide", "nome", "tema", "titulo_do_slide", "assunto"]);
        const description = pick(row, ["descricao", "descricao_do_slide", "resumo", "subtitulo"]);
        const price = pick(row, ["preco", "valor", "preco_r$", "preco_r", "preco_em_reais"]);
        const buyLink = pick(row, ["link_compra", "link_de_compra", "link_de_pagamento", "link", "url"]);
        const video = pick(row, ["video", "link_video", "video_link", "reel"]);
        const image = pick(row, ["imagem", "thumb", "thumbnail", "capa", "foto"]);
        const active = pick(row, ["ativo", "publicar", "status"]);

        let area = pick(row, ["area_do_tema", "area_tema", "area", "especialidade", "categoria"]);
        if (!area) {
          const keys = Object.keys(row);
          const buyIndex = keys.findIndex(function (k) {
            return k === "link_compra" || k === "link_de_compra" || k === "link_de_pagamento";
          });
          if (buyIndex >= 0 && buyIndex + 1 < keys.length) {
            area = String(row[keys[buyIndex + 1]] || "").trim();
          }
        }

        return {
          title: title || "Slide sem titulo",
          description: description || "Apresentacao pronta para estudo, aula ou plantao.",
          price: price || "",
          buyLink: sanitizeUrl(buyLink),
          video: sanitizeUrl(video),
          image: sanitizeUrl(image),
          area: area || "Sem categoria",
          active: isActiveValue(active)
        };
      }

      function parseCsv(text) {
        const lines = text.split(/\r?\n/).filter(function (l) { return l.trim() !== ""; });
        if (!lines.length) return [];

        const splitCsvLine = function (line) {
          const result = [];
          let cur = "";
          let inQuotes = false;
          for (let i = 0; i < line.length; i++) {
            const ch = line[i];
            const next = line[i + 1];
            if (ch === "\"" && inQuotes && next === "\"") {
              cur += "\"";
              i++;
            } else if (ch === "\"") {
              inQuotes = !inQuotes;
            } else if (ch === "," && !inQuotes) {
              result.push(cur);
              cur = "";
            } else {
              cur += ch;
            }
          }
          result.push(cur);
          return result.map(function (v) { return v.trim(); });
        };

        const headerValues = splitCsvLine(lines[0]).map(normalizeKey);
        const rows = [];

        for (let i = 1; i < lines.length; i++) {
          const cells = splitCsvLine(lines[i]);
          if (!cells.length) continue;
          const row = {};
          headerValues.forEach(function (h, idx) {
            row[h || ("col_" + idx)] = cells[idx] || "";
          });
          rows.push(row);
        }
        return rows;
      }

      async function loadWithFetch(url) {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Falha ao buscar planilha (" + response.status + ").");
        }
        return response.text();
      }

      function loadGvizJsonp(sheetId, gid, sheetName) {
        return new Promise(function (resolve, reject) {
          const callbackName = "__sheetCb_" + Math.random().toString(36).slice(2);
          const script = document.createElement("script");

          const cleanup = function () {
            delete window[callbackName];
            if (script.parentNode) script.parentNode.removeChild(script);
          };

          window[callbackName] = function (payload) {
            cleanup();
            resolve(payload);
          };

          script.onerror = function () {
            cleanup();
            reject(new Error("Falha ao carregar JSONP."));
          };

          const base = "https://docs.google.com/spreadsheets/d/" + encodeURIComponent(sheetId) + "/gviz/tq";
          const query = gid
            ? "?gid=" + encodeURIComponent(gid) + "&tqx=responseHandler:" + callbackName
            : "?sheet=" + encodeURIComponent(sheetName) + "&tqx=responseHandler:" + callbackName;
          script.src = base + query;
          document.head.appendChild(script);
        });
      }

      async function loadRowsFromSheet(sheetId, gid, sheetName) {
        const gvizBase = "https://docs.google.com/spreadsheets/d/" + encodeURIComponent(sheetId) + "/gviz/tq";
        const gvizUrl = gid
          ? gvizBase + "?tqx=out:json&gid=" + encodeURIComponent(gid)
          : gvizBase + "?tqx=out:json&sheet=" + encodeURIComponent(sheetName);
        try {
          const gvizRaw = await loadWithFetch(gvizUrl);
          const payload = parseGvizEnvelope(gvizRaw);
          return rowsFromTable(payload.table || {});
        } catch (_) {
          try {
            const payload = await loadGvizJsonp(sheetId, gid, sheetName);
            return rowsFromTable(payload.table || {});
          } catch (_) {
            const csvUrl = "https://docs.google.com/spreadsheets/d/" + encodeURIComponent(sheetId) +
              "/export?format=csv&gid=" + encodeURIComponent(gid || "");
            const csvRaw = await loadWithFetch(csvUrl);
            return parseCsv(csvRaw);
          }
        }
      }

      function getCategories(slides) {
        const unique = Array.from(new Set(slides.map(function (s) { return s.area; }).filter(Boolean)));
        unique.sort(function (a, b) {
          return a.localeCompare(b, "pt-BR");
        });
        return ["Todas"].concat(unique);
      }

      function renderFilters() {
        const categories = getCategories(allSlides);
        filtersEl.innerHTML = "";
        categories.forEach(function (category) {
          const button = document.createElement("button");
          button.type = "button";
          button.className = "chip" + (category === activeCategory ? " active" : "");
          button.textContent = category;
          button.addEventListener("click", function () {
            activeCategory = category;
            renderFilters();
            renderGrid();
          });
          filtersEl.appendChild(button);
        });
      }

      function getVisibleSlides() {
        return allSlides.filter(function (slide) {
          const matchesCategory = activeCategory === "Todas" || slide.area === activeCategory;
          const searchSource = (slide.title + " " + slide.description + " " + slide.area).toLowerCase();
          const matchesSearch = searchTerm === "" || searchSource.includes(searchTerm);
          return matchesCategory && matchesSearch;
        });
      }

      function buildCard(slide) {
        const card = document.createElement("article");
        card.className = "card";

        const image = slide.image && slide.image !== "#" ? slide.image : "https://via.placeholder.com/960x540/0f1118/6f7790?text=Slide+UsoJaleco";
        const hasVideo = slide.video && slide.video !== "#";
        const hasBuy = slide.buyLink && slide.buyLink !== "#";
        const priceText = slide.price ? slide.price : "A consultar";

        card.innerHTML = [
          "<div class=\"thumbWrap\">",
          "  <span class=\"areaTag\">" + escapeHtml(slide.area) + "</span>",
          "  <img loading=\"lazy\" src=\"" + escapeAttr(image) + "\" alt=\"" + escapeAttr(slide.title) + "\">",
          "</div>",
          "<div class=\"cardBody\">",
          "  <h3 class=\"title\">" + escapeHtml(slide.title) + "</h3>",
          "  <p class=\"desc\">" + escapeHtml(slide.description) + "</p>",
          "  <div class=\"priceRow\">",
          "    <div class=\"price\"><small>R$</small>" + escapeHtml(priceText) + "</div>",
          "  </div>",
          "  <div class=\"actions\">",
          hasVideo
            ? "    <a class=\"btn btnVideo\" href=\"" + escapeAttr(slide.video) + "\" target=\"_blank\" rel=\"noopener noreferrer\">Ver video</a>"
            : "    <span class=\"btn btnVideo\" style=\"opacity:.55;pointer-events:none;\">Sem video</span>",
          hasBuy
            ? "    <a class=\"btn btnBuy\" href=\"" + escapeAttr(slide.buyLink) + "\" target=\"_blank\" rel=\"noopener noreferrer\">Comprar</a>"
            : "    <span class=\"btn btnBuy\" style=\"opacity:.55;pointer-events:none;\">Sem link</span>",
          "  </div>",
          "</div>"
        ].join("\n");

        return card;
      }

      function renderGrid() {
        const visible = getVisibleSlides();
        gridEl.innerHTML = "";

        if (!visible.length) {
          const empty = document.createElement("div");
          empty.className = "empty";
          empty.textContent = "Nenhum slide encontrado com esse filtro.";
          gridEl.appendChild(empty);
          setStatus("0 slides encontrados.", "");
          return;
        }

        visible.forEach(function (slide) {
          gridEl.appendChild(buildCard(slide));
        });

        setStatus(visible.length + " slides encontrados.", "ok");
      }

      function escapeHtml(value) {
        return String(value)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function escapeAttr(value) {
        return escapeHtml(value);
      }

      async function init() {
        try {
          setStatus("Carregando slides da planilha...", "");
          const rows = await loadRowsFromSheet(SHEET_ID, SHEET_GID, SHEET_NAME);
          const slides = rows.map(mapRowToSlide).filter(function (s) { return s.active; });

          if (!slides.length) {
            setStatus("Planilha carregada, mas sem slides ativos.", "error");
            renderGrid();
            return;
          }

          allSlides = slides;
          renderFilters();
          renderGrid();
        } catch (error) {
          setStatus(
            "Falha ao carregar a planilha. Verifique permissao publica e aba/gid. Erro: " + error.message,
            "error"
          );
        }
      }

      searchInput.addEventListener("input", function (event) {
        searchTerm = String(event.target.value || "").trim().toLowerCase();
        renderGrid();
      });

      init();
    })();
  </script>
</body>
</html>
