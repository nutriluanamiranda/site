<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UsoJaleco | Comprar Slides de Medicina</title>
  <meta name="description" content="Templates e apresentações prontas para medicina, organizadas por especialidade.">
  <meta name="theme-color" content="#0c1228">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/arthurambrosi/usojaleco/0204905b333f11d1eec3c7c6667d17dbfb457774/Design%20sem%20nome%20(28).png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #070a14;
      --bg-2: #0c1228;
      --panel: #101938;
      --panel-2: #16244f;
      --ink: #f7f8fd;
      --muted: #9ea7c2;
      --line: rgba(162, 181, 240, 0.22);
      --brand: #ff6a1a;
      --brand-2: #ff944f;
      --chip: rgba(255, 106, 26, 0.18);
      --ok: #6ce8b2;
      --radius: 16px;
      --shadow: 0 24px 46px rgba(0, 4, 14, 0.45);
      --maxw: 1160px;
      --tap: 46px;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
    }

    body {
      font-family: "Manrope", system-ui, -apple-system, "Segoe UI", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1100px 540px at 85% -10%, rgba(255, 106, 26, 0.2), transparent 65%),
        radial-gradient(980px 500px at -10% 15%, rgba(71, 123, 255, 0.17), transparent 60%),
        linear-gradient(180deg, var(--bg-2), var(--bg) 60%);
      line-height: 1.5;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .wrap {
      width: min(var(--maxw), calc(100% - 1.6rem));
      margin-inline: auto;
      padding: 1.2rem 0 2rem;
    }

    .top {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.4rem;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 0.7rem;
    }

    .brand img {
      width: 38px;
      height: 38px;
      object-fit: contain;
      border-radius: 10px;
      background: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 5px;
    }

    .brand span {
      font-family: "Bebas Neue", sans-serif;
      letter-spacing: 0.05em;
      font-size: 2rem;
      line-height: 1;
    }

    .hero {
      border: 1px solid var(--line);
      border-radius: calc(var(--radius) + 6px);
      padding: clamp(1.2rem, 2.6vw, 2rem);
      background:
        linear-gradient(120deg, rgba(11, 21, 46, 0.88), rgba(13, 24, 49, 0.94)),
        linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0));
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      isolation: isolate;
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -40% auto auto -18%;
      width: 500px;
      height: 500px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(255, 106, 26, 0.22), transparent 62%);
      z-index: -1;
    }

    .hero h1 {
      margin: 0;
      font-family: "Bebas Neue", sans-serif;
      letter-spacing: 0.04em;
      line-height: 0.95;
      font-size: clamp(2.5rem, 8vw, 4.6rem);
      max-width: 14ch;
    }

    .hero p {
      margin: 0.8rem 0 0;
      max-width: 70ch;
      color: var(--muted);
      font-size: clamp(0.95rem, 1.9vw, 1.06rem);
    }

    .panel {
      margin-top: 1rem;
      border: 1px solid var(--line);
      background: rgba(9, 15, 33, 0.84);
      border-radius: var(--radius);
      padding: 1rem;
    }

    .status {
      margin: 0;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .status.ok { color: var(--ok); }
    .status.error { color: #ff8c8c; }

    .cats {
      margin-top: 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.55rem;
    }

    .cat-btn {
      border: 1px solid var(--line);
      background: rgba(17, 29, 59, 0.95);
      color: #eaf0ff;
      min-height: var(--tap);
      padding: 0.35rem 0.78rem;
      border-radius: 999px;
      cursor: pointer;
      font: inherit;
      font-size: 0.86rem;
      font-weight: 600;
      transition: transform .2s ease, border-color .2s ease, background .2s ease;
    }

    .cat-btn:hover { transform: translateY(-1px); }

    .cat-btn.is-active {
      border-color: rgba(255, 148, 79, 0.9);
      background: linear-gradient(180deg, rgba(255, 106, 26, 0.95), rgba(242, 88, 4, 0.95));
      color: #fff;
    }

    .grid {
      margin-top: 1rem;
      display: grid;
      grid-template-columns: repeat(12, minmax(0, 1fr));
      gap: 0.9rem;
    }

    .card {
      grid-column: span 4;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(19, 31, 65, 0.98), rgba(13, 23, 47, 0.95));
      padding: 1rem;
      display: grid;
      gap: 0.85rem;
      min-height: 250px;
      box-shadow: 0 14px 30px rgba(0, 4, 14, 0.35);
    }

    .badge {
      display: inline-flex;
      width: fit-content;
      align-items: center;
      border-radius: 999px;
      border: 1px solid rgba(255, 148, 79, 0.45);
      padding: 0.2rem 0.55rem;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: var(--chip);
      color: #ffd8bf;
      font-weight: 700;
    }

    .card h2 {
      margin: 0;
      font-size: 1.1rem;
      line-height: 1.25;
      text-wrap: balance;
    }

    .desc {
      margin: 0;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .meta {
      display: grid;
      gap: 0.42rem;
      color: #dfe8ff;
      font-size: 0.86rem;
      margin-top: auto;
    }

    .buy {
      margin-top: 0.45rem;
      min-height: var(--tap);
      border: 0;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 0.55rem 0.85rem;
      background: linear-gradient(180deg, var(--brand-2), var(--brand));
      color: #1c130d;
      font-weight: 800;
      letter-spacing: 0.01em;
    }

    .empty {
      grid-column: 1 / -1;
      border: 1px dashed var(--line);
      border-radius: var(--radius);
      padding: 1rem;
      color: var(--muted);
      text-align: center;
    }

    .foot {
      margin-top: 1rem;
      padding-top: 0.8rem;
      border-top: 1px solid rgba(162, 181, 240, 0.22);
      font-size: 0.8rem;
      color: #8f9abc;
    }

    @media (max-width: 1024px) {
      .card { grid-column: span 6; }
    }

    @media (max-width: 700px) {
      .wrap {
        width: min(var(--maxw), calc(100% - 1rem));
        padding-top: 0.7rem;
      }

      .brand span { font-size: 1.72rem; }
      .hero { padding: 1rem; }
      .panel { padding: 0.8rem; }
      .card {
        grid-column: 1 / -1;
        min-height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <a class="brand" href="../index.html" aria-label="Ir para página principal">
        <img id="brand-logo" src="https://raw.githubusercontent.com/arthurambrosi/usojaleco/0204905b333f11d1eec3c7c6667d17dbfb457774/Design%20sem%20nome%20(28).png" alt="Logo UsoJaleco">
        <span>UsoJaleco</span>
      </a>
    </header>

    <section class="hero">
      <h1>COMPRAR SLIDES DE MEDICINA</h1>
      <p>
        Catálogo dinâmico com links da sua planilha. Os cards são separados por especialidade usando a coluna
        <strong>Área do tema</strong>, posicionada após o link de compra.
      </p>
    </section>

    <section class="panel">
      <p id="status" class="status">Carregando planilha...</p>
      <div id="categories" class="cats" aria-label="Filtros por especialidade"></div>
      <div id="slides-grid" class="grid" aria-live="polite"></div>
      <div class="foot">
        Fonte de dados: aba <strong>Slides</strong> da planilha configurada no script.
      </div>
    </section>
  </div>

  <script>
    (function () {
      const LOGO = "https://raw.githubusercontent.com/arthurambrosi/usojaleco/0204905b333f11d1eec3c7c6667d17dbfb457774/Design%20sem%20nome%20(28).png";
      const SHEET_ID_FIXED = "COLE_AQUI_O_ID_DA_MESMA_PLANILHA";
      const SHEET_TAB = "Slides";
      const querySheetId = new URLSearchParams(window.location.search).get("sheetId");
      const SHEET_ID = querySheetId || window.USOJALECO_SHEET_ID || SHEET_ID_FIXED;

      const statusEl = document.getElementById("status");
      const categoriesEl = document.getElementById("categories");
      const gridEl = document.getElementById("slides-grid");
      const logoEl = document.getElementById("brand-logo");

      let allSlides = [];
      let activeCategory = "Todas";

      function normalizeKey(key) {
        return String(key || "")
          .trim()
          .toLowerCase()
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "")
          .replace(/\s+/g, "_");
      }

      function pick(row, keys) {
        for (const key of keys) {
          if (row[key] !== undefined && row[key] !== null && String(row[key]).trim() !== "") {
            return String(row[key]).trim();
          }
        }
        return "";
      }

      function updateStatus(text, mode) {
        statusEl.textContent = text;
        statusEl.className = "status" + (mode ? " " + mode : "");
      }

      function parseGoogleSheetJson(text) {
        const start = text.indexOf("{");
        const end = text.lastIndexOf("}");
        if (start < 0 || end < 0) {
          throw new Error("Resposta da planilha inválida.");
        }
        return JSON.parse(text.slice(start, end + 1));
      }

      function loadGoogleSheetJsonp(sheetId, sheetTab) {
        return new Promise((resolve, reject) => {
          const callbackName = "__sheetCb_" + Math.random().toString(36).slice(2);
          const script = document.createElement("script");

          const cleanup = () => {
            delete window[callbackName];
            if (script.parentNode) {
              script.parentNode.removeChild(script);
            }
          };

          window[callbackName] = function (payload) {
            cleanup();
            resolve(payload);
          };

          script.onerror = function () {
            cleanup();
            reject(new Error("Não foi possível carregar a planilha (JSONP)."));
          };

          script.src = "https://docs.google.com/spreadsheets/d/" + encodeURIComponent(sheetId) +
            "/gviz/tq?sheet=" + encodeURIComponent(sheetTab) +
            "&tqx=responseHandler:" + callbackName;

          document.head.appendChild(script);
        });
      }

      function toRows(table) {
        const cols = (table.cols || []).map((c, index) => {
          const label = (c && c.label ? c.label : "").trim();
          return label || "col_" + index;
        });

        const rawRows = (table.rows || []).map((r) => {
          const out = {};
          cols.forEach((col, idx) => {
            const cell = r && r.c ? r.c[idx] : null;
            out[normalizeKey(col)] = cell && cell.v !== null ? String(cell.v).trim() : "";
          });
          return out;
        });

        const headerMissing = cols.every((c) => /^col_\d+$/.test(c));
        if (!headerMissing || !rawRows.length) {
          return rawRows;
        }

        const firstRow = rawRows[0];
        const firstKeys = Object.keys(firstRow);
        const dynamicHeaders = firstKeys.map((k, idx) => normalizeKey(firstRow[k]) || "col_" + idx);

        return rawRows.slice(1).map((row) => {
          const out = {};
          firstKeys.forEach((k, idx) => {
            out[dynamicHeaders[idx]] = row[k];
          });
          return out;
        });
      }

      function mapSlide(row) {
        const title = pick(row, ["titulo", "slide", "nome", "tema", "titulo_do_slide", "assunto"]);
        const description = pick(row, ["descricao", "descricao_do_slide", "subtitulo", "resumo"]);
        const price = pick(row, ["preco", "valor", "preco_r$", "preco_r", "preco_em_reais"]);
        const buyLink = pick(row, ["link_compra", "compra", "link_de_compra", "link_de_pagamento", "link", "url"]);

        const keys = Object.keys(row);
        let area = pick(row, ["area_do_tema", "area", "especialidade", "categoria"]);

        if (!area) {
          const buyIndex = keys.findIndex((k) => k === "link_compra" || k === "link_de_compra" || k === "compra");
          if (buyIndex >= 0 && buyIndex + 1 < keys.length) {
            area = String(row[keys[buyIndex + 1]] || "").trim();
          }
        }

        return {
          title: title || "Slide sem título",
          description: description || "Apresentação pronta para uso em estudo, aula ou revisão.",
          area: area || "Sem categoria",
          price: price || "",
          buyLink: buyLink || "#"
        };
      }

      function sanitizeUrl(url) {
        try {
          const parsed = new URL(url, window.location.href);
          return parsed.protocol === "http:" || parsed.protocol === "https:" ? parsed.href : "#";
        } catch (_) {
          return "#";
        }
      }

      function categoriesFromSlides(slides) {
        const set = new Set(slides.map((s) => s.area).filter(Boolean));
        return ["Todas", ...Array.from(set).sort((a, b) => a.localeCompare(b, "pt-BR"))];
      }

      function renderCategories() {
        const categories = categoriesFromSlides(allSlides);
        categoriesEl.innerHTML = "";

        categories.forEach((category) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "cat-btn" + (category === activeCategory ? " is-active" : "");
          btn.textContent = category;
          btn.addEventListener("click", function () {
            activeCategory = category;
            renderCategories();
            renderGrid();
          });
          categoriesEl.appendChild(btn);
        });
      }

      function renderGrid() {
        const visible = activeCategory === "Todas"
          ? allSlides
          : allSlides.filter((slide) => slide.area === activeCategory);

        gridEl.innerHTML = "";

        if (!visible.length) {
          const empty = document.createElement("div");
          empty.className = "empty";
          empty.textContent = "Nenhum slide encontrado para essa especialidade.";
          gridEl.appendChild(empty);
          return;
        }

        visible.forEach((slide) => {
          const card = document.createElement("article");
          card.className = "card";

          const area = document.createElement("span");
          area.className = "badge";
          area.textContent = slide.area;

          const title = document.createElement("h2");
          title.textContent = slide.title;

          const desc = document.createElement("p");
          desc.className = "desc";
          desc.textContent = slide.description;

          const meta = document.createElement("div");
          meta.className = "meta";

          if (slide.price) {
            const price = document.createElement("strong");
            price.textContent = "Valor: " + slide.price;
            meta.appendChild(price);
          }

          const buy = document.createElement("a");
          buy.className = "buy";
          buy.href = sanitizeUrl(slide.buyLink);
          buy.target = "_blank";
          buy.rel = "noopener noreferrer";
          buy.textContent = "Comprar slide";

          card.appendChild(area);
          card.appendChild(title);
          card.appendChild(desc);
          card.appendChild(meta);
          card.appendChild(buy);
          gridEl.appendChild(card);
        });
      }

      async function loadSlides() {
        if (!SHEET_ID || SHEET_ID === "COLE_AQUI_O_ID_DA_MESMA_PLANILHA") {
          updateStatus("Defina o SHEET_ID no script para carregar os slides da sua planilha.", "error");
          return;
        }

        updateStatus("Carregando dados da aba Slides...");

        let payload = null;

        try {
          const endpoint = "https://docs.google.com/spreadsheets/d/" + encodeURIComponent(SHEET_ID) +
            "/gviz/tq?tqx=out:json&sheet=" + encodeURIComponent(SHEET_TAB);
          const response = await fetch(endpoint);
          if (!response.ok) {
            throw new Error("Falha ao acessar a planilha (" + response.status + ").");
          }
          const text = await response.text();
          payload = parseGoogleSheetJson(text);
        } catch (_) {
          payload = await loadGoogleSheetJsonp(SHEET_ID, SHEET_TAB);
        }

        const rows = toRows(payload.table || {});
        const mapped = rows.map(mapSlide).filter((item) => item.buyLink && item.buyLink !== "#");

        allSlides = mapped;
      }

      async function init() {
        try {
          await loadSlides();
          if (!allSlides.length) {
            updateStatus("Planilha carregada, mas não foram encontrados slides válidos.", "error");
            return;
          }
          updateStatus("Planilha carregada com sucesso.", "ok");
          renderCategories();
          renderGrid();
        } catch (error) {
          updateStatus("Erro ao carregar os slides: " + error.message, "error");
        }
      }

      // Mantém a URL da logo no escopo para fácil atualização futura.
      window.USOJALECO_LOGO = LOGO;
      if (logoEl) {
        logoEl.src = LOGO;
      }
      init();
    })();
  </script>
</body>
</html>
